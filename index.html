<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jalwa Pro Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #0d131f; --card: #1f293a; --gold: #ff9800; --blue: #2196f3; --green: #00c853; --tg: #0088cc; }
        body { margin: 0; background: #000; font-family: 'Segoe UI', sans-serif; color: white; overflow-x: hidden; }
        .app-container { width: 100%; max-width: 480px; margin: auto; background: var(--bg); min-height: 100vh; padding-bottom: 80px; }
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: var(--card); border-radius: 0 0 20px 20px; }
        .avatar { width: 40px; height: 40px; background: var(--gold); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #000; font-weight: bold; }
        .wallet-box { margin: 15px; padding: 25px; background: linear-gradient(135deg, #1e3a8a, #1e40af); border-radius: 24px; }
        .bonus-card, .refer-card, .tg-card { margin: 10px 15px; background: var(--card); padding: 15px; border-radius: 15px; border: 1px solid #2d3a4f; position: relative; overflow: hidden; }
        
        .tg-card { background: rgba(0, 136, 204, 0.1); border-color: var(--tg); display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
        .tg-icon { color: var(--tg); font-size: 24px; }

        .bonus-card { border-color: var(--blue); display: flex; justify-content: space-between; align-items: center; }
        .btn-claim { background: var(--blue); color: white; border: none; padding: 8px 15px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-claim:disabled { background: #444; color: #888; cursor: not-allowed; }

        .game-launch-banner { margin: 10px 15px; background: linear-gradient(45deg, #1a1a1a, #2d3a4f); border-radius: 20px; padding: 20px; display: flex; align-items: center; gap: 15px; border: 1px solid #3d4b5f; cursor: pointer; }
        .page-view { display: none; }
        .page-view.active { display: block; }
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 480px; background: #161e2b; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #2d3a4f; z-index: 1000; }
        .nav-item { text-align: center; color: #64748b; font-size: 11px; flex: 1; cursor: pointer; }
        .nav-item.active { color: var(--gold); }

        #customToast { visibility: hidden; min-width: 250px; background-color: var(--green); color: #fff; text-align: center; border-radius: 10px; padding: 16px; position: fixed; z-index: 10001; left: 50%; top: 50%; transform: translate(-50%, -50%); font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.6); font-size: 16px; border: 1px solid rgba(255,255,255,0.2); }
        #customToast.show { visibility: visible; animation: fadeInOut 2s; }
        @keyframes fadeInOut { 0% {opacity: 0; transform: translate(-50%, -40%);} 20% {opacity: 1; transform: translate(-50%, -50%);} 80% {opacity: 1; transform: translate(-50%, -50%);} 100% {opacity: 0; transform: translate(-50%, -60%);} }
    </style>
</head>
<body>

<div id="customToast">Action Success!</div>

<div class="app-container">
    <div class="header">
        <div style="display:flex; align-items:center; gap:10px;">
            <div class="avatar" id="avatarIcon">J</div>
            <div>
                <div style="font-size: 10px; color: #888;">ID: <span id="uID">...</span></div>
                <div id="uNameDisplay" style="font-weight: bold;">Welcome Back</div>
            </div>
        </div>
        <div onclick="location.href='wallet.html'"><i class="fas fa-wallet" style="color:var(--gold); font-size:20px;"></i></div>
    </div>

    <div id="home" class="page-view active">
        <div class="wallet-box">
            <div style="font-size: 13px; opacity: 0.8;">Total Assets</div>
            <div style="font-size: 32px; font-weight: bold; margin: 5px 0;">₹ <span id="mainBal">0.00</span></div>
            <div style="font-size: 11px; color: #4ade80;"><i class="fas fa-shield-alt"></i> Secure Wallet</div>
        </div>

        <div class="bonus-card">
            <div>
                <div style="font-weight: bold; font-size: 14px;">Daily Gift</div>
                <div style="font-size: 11px; color: #aaa;">Claim ₹20 every 24 hours</div>
            </div>
            <button class="btn-claim" id="dailyBtn" onclick="claimDaily()">CLAIM</button>
        </div>
        
        <div class="refer-card">
            <div style="font-size: 14px; font-weight: bold; color: var(--gold); letter-spacing: 0.5px;">REFER & EARN ₹250</div>
            <div style="font-size: 11px; color: #888; margin-top: 4px;">Get ₹250 when friend recharges ₹500+</div>
            <button onclick="copyReferLink()" style="background:var(--gold); border:none; width: 100%; padding:10px; border-radius:8px; margin-top:12px; font-weight:bold; cursor:pointer; color:#000;">COPY REFER LINK</button>
        </div>

        <div class="tg-card" onclick="window.open('https://t.me/Realtrademods8911', '_blank')">
            <div>
                <div style="font-weight: bold; color: var(--tg); font-size: 14px;">JOIN OFFICIAL TELEGRAM</div>
                <div style="font-size: 11px; color: #888; margin-top: 4px;">Predictions & Updates</div>
            </div>
            <i class="fab fa-telegram tg-icon"></i>
        </div>

        <div class="game-launch-banner" onclick="location.href='game.html'">
            <div style="width:50px; height:50px; background:var(--gold); border-radius:10px; display:flex; align-items:center; justify-content:center; color:#000;"><i class="fas fa-gamepad"></i></div>
            <div>
                <h3 style="margin:0;">WinGo 30s</h3>
                <p style="margin:0; font-size:12px; opacity:0.7;">Play & Win Real Cash</p>
            </div>
            <i class="fas fa-chevron-right" style="margin-left:auto; opacity:0.5;"></i>
        </div>
    </div>

    <div id="wallet" class="page-view">
        <div style="padding:20px; text-align:center;">
            <div class="wallet-box">
                <div style="font-size: 14px;">Current Balance</div>
                <div style="font-size: 30px; font-weight: bold;">₹ <span id="walletBal">0.00</span></div>
            </div>
            <button onclick="location.href='wallet.html'" style="width:100%; padding:15px; background:var(--blue); color:white; border:none; border-radius:15px; font-weight:bold; margin-top:20px;">OPEN WALLET</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="showPage('home', this)"><i class="fas fa-house"></i><br>Home</div>
        <div class="nav-item" onclick="showPage('wallet', this)"><i class="fas fa-wallet"></i><br>Wallet</div>
        <div class="nav-item" onclick="logout()"><i class="fas fa-sign-out-alt"></i><br>Logout</div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://jalwa-v2-ad222-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const userId = localStorage.getItem('jalwa_id');

    if(!userId) window.location.replace("login.html");

    function showToast(msg) {
        const t = document.getElementById("customToast");
        t.innerText = msg;
        t.className = "show";
        setTimeout(() => { t.className = ""; }, 2000);
    }

    function showPage(id, el) {
        document.querySelectorAll('.page-view').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
    }

    window.onload = () => {
        if(!userId) return;
        
        // Removed browser alert, replaced with Toast
        if(localStorage.getItem('just_logged_in')){
            showToast("Login Successful!");
            localStorage.removeItem('just_logged_in');
        }

        db.ref('users/' + userId).on('value', (snap) => {
            const data = snap.val();
            if(data) {
                document.getElementById('uID').innerText = userId;
                document.getElementById('uNameDisplay').innerText = data.name || "User";
                document.getElementById('avatarIcon').innerText = (data.name || "U").charAt(0).toUpperCase();
                let val = Number(data.balance || 0);
                document.getElementById('mainBal').innerText = val.toFixed(2);
                document.getElementById('walletBal').innerText = val.toFixed(2);

                if(data.totalRecharge >= 500 && data.referredBy && data.referredBy !== "DIRECT" && !data.referRewardSent) {
                    sendReferReward(data.referredBy);
                }

                const today = new Date().toDateString();
                if(data.lastClaim === today) {
                    document.getElementById('dailyBtn').disabled = true;
                    document.getElementById('dailyBtn').innerText = "DONE";
                }
            }
        });
    };

    function claimDaily() {
        db.ref('users/' + userId).once('value', (snap) => {
            const data = snap.val();
            const today = new Date().toDateString();
            if(data.lastClaim === today) {
                showToast("Already claimed today!");
            } else {
                db.ref('users/' + userId).update({
                    balance: (data.balance || 0) + 20,
                    lastClaim: today
                }).then(() => showToast("₹20 Daily Bonus Added!"));
            }
        });
    }

    function sendReferReward(refID) {
        db.ref('users/' + refID).once('value', (snap) => {
            if(snap.exists()) {
                const refData = snap.val();
                db.ref('users/' + refID).update({
                    balance: (refData.balance || 0) + 250
                }).then(() => {
                    db.ref('users/' + userId).update({ referRewardSent: true });
                    console.log("Referral Reward of ₹250 Sent to " + refID);
                });
            }
        });
    }

    function copyReferLink() {
        const link = "https://132deepak.github.io/Jalwa-V7/register.html?ref=" + userId;
        navigator.clipboard.writeText(link).then(() => {
            showToast("Link Copied Successfully!");
        });
    }

    function logout() { localStorage.clear(); window.location.replace("login.html"); }
</script>

</body>
</html>

