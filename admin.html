<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jalwa V2 - Final Master Admin</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #0b0f19; --card: #161d2b; --gold: #ff9800; --green: #00c853; --red: #ff5252; --blue: #00e5ff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; overflow-x: hidden; }
        .section { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid #2d3a4f; margin-bottom: 15px; }
        h3 { color: var(--gold); margin-top: 0; font-size: 16px; border-bottom: 1px solid #333; padding-bottom: 8px; text-transform: uppercase; }
        .high-load { background: var(--red) !important; animation: blink 0.6s infinite; border: 2px solid white !important; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        
        /* Aviator Special UI */
        .aviator-box { border: 2px solid #d11345; position: relative; }
        .avi-stats { display: flex; justify-content: space-between; margin-bottom: 10px; background: #000; padding: 10px; border-radius: 8px; }
        .stat-item { text-align: center; flex: 1; }
        .stat-item span { display: block; font-size: 10px; color: #888; }
        .stat-item b { font-size: 16px; color: var(--blue); }
        .control-input { display: flex; gap: 10px; margin-top: 10px; }
        .control-input input { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #444; background: #000; color: #fff; font-weight: bold; }
        
        /* Common UI */
        .bet-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
        .bet-card { padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; cursor: pointer; border: 1px solid #333; }
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .num-box { background: #1f293a; padding: 10px; border-radius: 5px; text-align: center; cursor: pointer; border: 1px solid #333; font-size: 14px; }
        .req-list { max-height: 250px; overflow-y: auto; }
        .req-item { background: #1f293a; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 4px solid var(--gold); }
        .btn { border: none; padding: 10px; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; }
        .btn-green { background: var(--green); }
        .btn-red { background: var(--red); }
        .btn-blue { background: var(--blue); color: #000; }
        .status-toggle { width: 100%; margin-top: 10px; font-size: 14px; }
    </style>
</head>
<body>

<div class="section">
    <h3 style="display:flex; justify-content:space-between;">
        <span><i class="fas fa-eye"></i> WINGO 30S TRACKER</span>
        <span id="curPeriod" style="color:#888; font-size:12px;">Period: --</span>
    </h3>
    <div class="bet-grid">
        <div id="box-Green" class="bet-card" style="background:var(--green)" onclick="forceResult('Green')">GREEN<br>₹<span id="sumG">0</span></div>
        <div id="box-Violet" class="bet-card" style="background:purple" onclick="forceResult('Violet')">VIOLET<br>₹<span id="sumV">0</span></div>
        <div id="box-Red" class="bet-card" style="background:var(--red)" onclick="forceResult('Red')">RED<br>₹<span id="sumR">0</span></div>
    </div>
    <div class="num-grid" id="numBets"></div>
</div>

<div class="section aviator-box">
    <h3><i class="fas fa-plane"></i> AVIATOR MASTER CONTROL</h3>
    
    <div class="avi-stats">
        <div class="stat-item"><span>LIVE BETS</span><b id="aviLiveBets">0</b></div>
        <div class="stat-item"><span>TOTAL LOAD</span><b id="aviTotalLoad">₹0</b></div>
        <div class="stat-item"><span>STATUS</span><b id="aviStatusText" style="color:var(--green)">ACTIVE</b></div>
    </div>

    <div class="control-input">
        <input type="number" id="nextCrash" placeholder="Fix Next Crash (e.g. 2.50)">
        <button class="btn btn-blue" onclick="setAviCrash()">FIX CRASH</button>
    </div>

    <div style="display: flex; gap: 10px;">
        <button id="aviOnBtn" class="btn btn-green status-toggle" onclick="toggleAviator(true)">ENABLE GAME</button>
        <button id="aviOffBtn" class="btn btn-red status-toggle" onclick="toggleAviator(false)">DISABLE (LOADING ONLY)</button>
    </div>
</div>

<div class="section">
    <h3><i class="fas fa-university"></i> WITHDRAWAL REQUESTS</h3>
    <div id="witList" class="req-list">Loading...</div>
</div>

<div class="section">
    <h3><i class="fas fa-plus-circle"></i> PENDING DEPOSITS</h3>
    <div id="depList" class="req-list">Loading...</div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://jalwa-v2-ad222-default-rtdb.firebaseio.com/" };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- WINGO LOGIC (UNCHANGED) ---
    let currentPeriod = "";
    setInterval(() => {
        const now = new Date();
        let pId = now.getFullYear().toString() + (now.getMonth()+1).toString().padStart(2,'0') + now.getDate().toString().padStart(2,'0') + "30" + Math.floor((now.getHours()*3600 + now.getMinutes()*60 + now.getSeconds())/30);
        if(currentPeriod !== pId) {
            currentPeriod = pId;
            document.getElementById('curPeriod').innerText = "Period: " + currentPeriod;
            syncBets(currentPeriod);
        }
    }, 1000);

    function syncBets(pId) {
        db.ref('bets/' + pId).on('value', snap => {
            let sums = { Green: 0, Red: 0, Violet: 0 };
            let numSums = Array(10).fill(0);
            snap.forEach(c => {
                let b = c.val();
                let amt = Number(b.amt || 0);
                let sel = b.sel;
                if(typeof sel === 'number') numSums[sel] += amt;
                else if(sums.hasOwnProperty(sel)) sums[sel] += amt;
            });
            document.getElementById('sumG').innerText = sums.Green;
            document.getElementById('sumV').innerText = sums.Violet;
            document.getElementById('sumR').innerText = sums.Red;
            let nHtml = "";
            for(let i=0; i<=9; i++) {
                nHtml += `<div class="num-box" onclick="forceResult(${i})">${i}<br>₹${numSums[i]}</div>`;
            }
            document.getElementById('numBets').innerHTML = nHtml;
        });
    }
    function forceResult(val) { db.ref('gameControl/nextResult').set(val).then(() => alert("Result Fixed: " + val)); }

    // --- NEW AVIATOR LOGIC ---
    
    // 1. Sync Aviator Live Data
    db.ref('aviator/live').on('value', snap => {
        let total = 0, count = 0;
        snap.forEach(child => {
            total += Number(child.val().amt || 0);
            count++;
        });
        document.getElementById('aviLiveBets').innerText = count;
        document.getElementById('aviTotalLoad').innerText = "₹" + total;
    });

    // 2. Set Next Crash Multiplier
    function setAviCrash() {
        let val = document.getElementById('nextCrash').value;
        if(!val || val < 1) return alert("Valid Multiplier Daalo!");
        db.ref('aviator/control/nextCrash').set(parseFloat(val))
        .then(() => alert("Next Crash Set to: " + val + "x"));
    }

    // 3. Toggle Game Status (Approve/Disable)
    function toggleAviator(status) {
        db.ref('aviator/control/active').set(status);
        alert(status ? "Game Enabled" : "Game Disabled (Users will see Loading)");
    }

    db.ref('aviator/control/active').on('value', snap => {
        let active = snap.val();
        let txt = document.getElementById('aviStatusText');
        txt.innerText = active ? "ACTIVE" : "DISABLED";
        txt.style.color = active ? "var(--green)" : "var(--red)";
    });

    // --- DEPOSIT/WITHDRAWAL LOGIC (UNCHANGED) ---
    db.ref('requests/withdrawals').on('value', snap => {
        let html = "";
        snap.forEach(child => {
            let w = child.val();
            if(w.status === 'pending' || !w.status) {
                html += `<div class="req-item"><b>UID: ${w.uid}</b> <span style="float:right; color:var(--red)">₹${w.amount}</span><br>
                    <button class="btn btn-green" onclick="handleWit('${child.key}','success')">PAID</button>
                    <button class="btn btn-red" onclick="handleWit('${child.key}','rejected','${w.uid}',${w.amount})">REJECT</button></div>`;
            }
        });
        document.getElementById('witList').innerHTML = html || "<p style='text-align:center;'>No Withdrawals</p>";
    });

    function handleWit(key, status, uid, amt) {
        if(status === 'rejected') db.ref('users/'+uid+'/balance').transaction(c => (Number(c)||0) + Number(amt));
        db.ref('requests/withdrawals/'+key).update({ status: status });
    }

    db.ref('requests/deposits').on('value', snap => {
        let html = "";
        snap.forEach(child => {
            let d = child.val();
            if(d.status === 'pending' || !d.status) {
                html += `<div class="req-item"><b>UID: ${d.uid}</b> <span style="float:right; color:var(--green)">₹${d.amount}</span><br>
                    <button class="btn btn-green" style="width:100%" onclick="approveDep('${child.key}','${d.uid}',${d.amount})">APPROVE</button></div>`;
            }
        });
        document.getElementById('depList').innerHTML = html || "<p style='text-align:center;'>No Deposits</p>";
    });

    function approveDep(key, uid, amt) {
        db.ref('users/'+uid+'/balance').transaction(c => (Number(c)||0) + Number(amt));
        db.ref('requests/deposits/'+key).update({ status: 'success' });
    }
</script>
</body>
</html>

